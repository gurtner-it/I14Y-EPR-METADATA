<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I14Y XML/JSON Transformer & API Upload</title>
    <link rel="stylesheet" href="app.css">
</head>
<body>
    <div class="container">
        <!-- Modern Toggle Switch -->
        <div class="env-toggle">
            <input type="radio" id="env-abn" name="environment" value="ABN" checked>
            <label for="env-abn">ABN</label>

            <input type="radio" id="env-prod" name="environment" value="PROD">
            <label for="env-prod">PROD</label>

            <span class="toggle-bg"></span>
        </div>


        <div class="header">   

            <h1>I14Y Transformer & API</h1>
            <p>Transform XML to JSON and upload to I14Y API</p>

        </div>

        <div class="main-content">
           <div class="tabs">
                <button class="tab active" data-tab="transform" onclick="switchTab('transform')">Transform Files</button>
                <button class="tab" data-tab="api" onclick="switchTab('api')">API Operations</button>
                <button class="tab" data-tab="readme" onclick="switchTab('readme')">Readme</button>
            </div>

            <!-- Transform Tab -->
            <div id="transform" class="tab-content active">
                <div class="info-box">
                    <h3>File Transformation</h3>
                    <p>Upload XML files to transform them into I14Y JSON format. Fill in the required metadata and select your files.</p>
                </div>

                <form id="transformForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="responsibleKey">Responsible Key *</label>
                            <input type="text" id="responsibleKey" name="responsibleKey" placeholder="e.g., PGR" value="PGR" required>
                        </div>
                        <div class="form-group">
                            <label for="deputyKey">Deputy Key *</label>
                            <input type="text" id="deputyKey" name="deputyKey" placeholder="e.g., SNE" value="SNE" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="dateValidFrom">Date Valid From *</label>
                        <input type="date" id="dateValidFrom" name="dateValidFrom" required>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="createNew" name="createNew">
                            <label for="createNew">Create new concept (not recommended! Should if possible always create a new version of a concept)</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="files">Select Files (XML)</label>
                        <div class="file-upload">
                            <input type="file" id="files" multiple accept=".xml" onchange="handleFileSelect(event)">
                            <label for="files" class="file-upload-label">
                                üìÅ Choose Files or Drag & Drop
                            </label>
                        </div>
                        <div id="fileList" class="file-list">
                            <span style="color: #999;">No files selected</span>
                        </div>
                    </div>

                    <button type="submit" class="btn">Transform Files</button>
                </form>
            </div>

            <!-- API Tab -->
            <div id="api" class="tab-content">
                <div class="info-box">
                    <h3>API Operations</h3>
                    <p>Perform various operations with the I14Y API including uploading concepts, managing codelists, and retrieving data.</p>
                </div>

                <form id="apiForm">
                    <div class="form-group">
                        <label for="apiMethod">API Method *</label>
                        <select id="apiMethod" name="apiMethod" onchange="updateApiForm()" required>
                            <option value="">Select an operation...</option>
                            <optgroup label="Upload Operations">
                                <option value="-pc">Post New Concept (tbt)</option>
                                <option value="-pmc">Post Multiple Concepts (tbt)</option>
                                <option value="-pcl">Post Codelist Entries</option>
                                <option value="-pmcl">Post Multiple Codelists</option>
                            </optgroup>
                            <optgroup label="Get Operations">
                                <option value="-gc">Get Concepts</option>
                                <option value="-gec">Get EPD Concepts</option>
                                <option value="-gci">Get Concept by identifier (OID)</option>
                                <option value="-gce">Get Codelist Entry</option>
                            </optgroup>
                            <optgroup label="Status & Publication level Methods:">
                                <option value="-spl">Set publication level of a concept</option>
                                <option value="-srs">Set registration status of concept</option>
                            </optgroup>
                            <optgroup label="Update/Delete">
                                <option value="-ucl">Update Codelist Entries (Delete & Post)</option>
                                <option value="-dcl">Delete Codelist Entries</option>
                                <option value="-dc">Delete Concept (CAVE: Should not be done, instead post a new concept and change status)</option>
                                <option value="-ucm">Update Codelist Mapping</option>
                            </optgroup>
                        </select>
                    </div>

                    <div id="apiParameters"></div>

                    <button type="submit" class="btn">Execute API Call</button>
                </form>
            </div>

            <!-- Short GUI Readme -->
            <div id="readme" class="tab-content">
            <div class="info-box">
                <h3>üöÄ Quick Workflow (GUI)</h3>
                <p>
                Use the web interface to transform XML code lists, upload them via the I14Y API, 
                and manage publication. Always start in <b>ABN (test)</b> mode and switch to 
                <b>PROD</b> once everything works.
                </p>
            </div>

            <ol>
                <li>
                <strong>Check your <code>.env</code> configuration</strong><br>
                - <code>API_MODE=ABN</code> (test first)<br>
                - <code>PROD</code> only once verified<br>
                - Fill in your <code>CLIENT_ID</code>, <code>CLIENT_SECRET</code>, 
                    and token URLs (see README for exact variables).
                </li>

                <li>
                <strong>Transform XML ‚Üí JSON</strong><br>
                In the GUI, choose the <b>Transform</b> function.  
                Your XML files from <code>AD_VS/XML</code> will be converted into I14Y-compliant JSON 
                and saved under <code>AD_VS/Transformed</code>.
                </li>

                <li>
                <strong>Upload to I14Y API</strong><br>
                In the GUI, select <b>Post Concept</b> or <b>Post Codelist</b>.  
                Use the transformed JSON file(s) as input.  
                This creates or updates your concepts in the chosen environment (ABN or PROD).
                </li>

                <li>
                <strong>Set Publication Level</strong><br>
                Still in the GUI, choose <b>Set Publication Level</b> and change from 
                <code>Internal</code> (default) to <code>Public</code>.
                <p class="hint">
                Common statuses are <b>Standard</b> (e.g. eCH or a defined standard), 
                <b>Recorded</b>, or <b>Retired</b>.
                </p>
                </li>

                <li>
                <strong>Verify Online</strong><br>
                Open the official <a href="https://www.i14y.admin.ch" target="_blank">I14Y portal</a> 
                and confirm that your concept or codelist is published correctly.
                </li>

                <li>
                <strong>Switch to PROD</strong><br>
                Once everything looks correct in ABN, update your <code>.env</code> to 
                <code>API_MODE=PROD</code> and repeat the same steps.
                </li>
            </ol>

            <p><em>üí° Tip: Always use ABN for safe testing before pushing data to PROD.</em></p>
            </div>


            <div id="output" class="output" style="display: none;">
                <div id="outputContent"></div>
            </div>
        </div>
        <div class="logos">
            <img src="img/ehs-logo.png">
            <img src="img/i14y-logo.png">
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>